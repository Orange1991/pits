<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta charset="utf-8"/>
    <title>Pits</title>
    <link rel="stylesheet" type="text/css" href="css/styles.css" />
    <script type="text/javascript" src=""></script>
  </head>
  <body onload="init()">
    <div id="main-container">
      <div id="sky-container">
        <div id="logo">
          <img src="img/pits.png" />
        </div>
        <div id="filling-one" class="filling hide"></div>
        <div id="filling-two" class="filling"></div>
      </div>
      <div id="earth-container">
        <div id="pit-one" class="pit"></div>
        <div id="pit-two" class="pit"></div>
        <div id="player"><img src="img/dog.png" /></div>
        <div id="award"><img src="img/bone.png" /></div>
      </div>
      <div id="nav-container">
        <div class="nav-block" id="nav-intro">
          <div class="nav-en">HOW</div>
          <div class="nav-zh">玩法</div>
        </div>
        <div class="nav-block" id="nav-start">
          <div class="nav-en">START</div>
          <div class="nav-zh">开始</div>
        </div>
        <div class="nav-block" id="nav-about">
          <div class="nav-en">ABOUT</div>
          <div class="nav-zh">关于</div>
        </div>
      </div>
      <div id="intro-container" class="hover-container">
        <div class="close-button" id="close-intro">&times;</div>
        <div class="intro-scroll">
          <div class="intro-pics-container">
            <div class="intro-inner">
              <span><img src="img/intro-1.png"/></span>
              <span><img src="img/intro-2.png"/></span>
              <span><img src="img/intro-3.png"/></span>
            </div>
          </div>
        </div>
      </div>
      <div id="about-container" class="hover-container">
        <div class="close-button" id="close-about">&times;</div>
        <div id="about-inner">
          <div id="about-info">
            <p>Pits is a webpage game for relaxing. Help our little friends to walk through the pits and get delicious food. Enjoy it!</p>
            <p>这是一款轻松的网页游戏。帮助小伙伴们越过坑以得到美味的食物。玩得开心！</p>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script type="text/javascript">
  var listen = function (obj, e, trigger) {
    addEventListener && obj.addEventListener(e, trigger);
  };
  var init = function () {
    var screenWidth = document.body.clientWidth;
    var screenHeight = document.body.clientHeight;
    var edgeLength = screenWidth < screenHeight ? screenWidth : screenHeight;
    var maxPitEdge = edgeLength / 5;
    var minPitEdge = maxPitEdge * 0.2;
    (minPitEdge > 20) && (minPitEdge = 20);
    var fillingMinEdge = minPitEdge / 2;
    var fillingMaxEdge = maxPitEdge * 2;
    var currentFillingEdge = fillingMinEdge;
    var mainContainer = document.querySelector('#main-container');
    var pitOne = document.querySelector('#pit-one');
    var pitTwo = document.querySelector('#pit-two');
    var fillingOne = document.querySelector('#filling-one');
    var fillingTwo = document.querySelector('#filling-two');
    var currentPit = pitOne;
    var currentFilling = fillingOne;
    var nextPit = pitTwo;
    var nextFilling = fillingTwo;
    document.body.className = screenWidth >= screenHeight ? 'horizontal' : 'vertical';
    var enlargeInterval;

    var openAbout = function () { document.querySelector('#about-container').className += ' show'; };
    var closeAbout = function () { document.querySelector('#about-container').className = 'hover-container'; };
    var openIntro = function () { document.querySelector('#intro-container').className += ' show'; };
    var closeIntro = function () { document.querySelector('#intro-container').className = 'hover-container'; };
    var initGame = function () {
      document.querySelector('#logo').className = 'hide';
      document.querySelector('#nav-container').className = 'hide';
      pitOne.style.width = maxPitEdge + 'px';
      pitOne.style.height = maxPitEdge + 'px';
      pitOne.style.left = (screenWidth - maxPitEdge) / 2 + 'px';
      fillingOne.className = 'filling';
      fillingOne.style.width = currentFillingEdge + 'px';
      fillingOne.style.height = currentFillingEdge + 'px';
      fillingOne.style.left = (screenWidth - currentFillingEdge) / 2 + 'px';
      fillingOne.style.top = '20px';
      listen(mainContainer, 'mousedown', startEnlargement);
      listen(mainContainer, 'mouseup', stopEnlargementAndFallDown);
    };
    var startEnlargement = function () {
      enlargeInterval && clearInterval(enlargeInterval);
      enlargeInterval = setInterval(function () {
        console.log(fillingMaxEdge)
        currentFillingEdge < fillingMaxEdge && (currentFillingEdge += 1);
        currentFilling.style.width = currentFillingEdge + 'px';
        currentFilling.style.height = currentFillingEdge + 'px';
        currentFilling.style.left = (screenWidth - currentFillingEdge) / 2 + 'px';
      }, 10);
    };
    var stopEnlargementAndFallDown = function () {
      enlargeInterval && clearInterval(enlargeInterval);
      enlargeInterval = null;
    };
    var startGame = function () {
      initGame();
    };
    listen(document.querySelector('#nav-about'), 'click', openAbout);
    listen(document.querySelector('#close-about'), 'click', closeAbout);
    listen(document.querySelector('#nav-intro'), 'click', openIntro);
    listen(document.querySelector('#close-intro'), 'click', closeIntro);
    listen(document.querySelector('#nav-start'), 'click', startGame);
  };
  </script>
</html>

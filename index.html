<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta charset="utf-8"/>
    <title>Pits</title>
    <link rel="stylesheet" type="text/css" href="css/styles.css" />
    <script type="text/javascript" src=""></script>
  </head>
  <body onload="init()">
    <div id="main-container">
      <div id="sky-container">
        <div id="logo">
          <img src="img/pits.png" />
        </div>
        <div id="filling-one" class="filling hide smooth"></div>
        <div id="filling-two" class="filling"></div>
      </div>
      <div id="earth-container">
        <div id="pit-one" class="pit smooth"></div>
        <div id="pit-two" class="pit"></div>
        <div id="player"><img src="img/dog.png" /></div>
        <div id="award"><img src="img/bone.png" /></div>
      </div>
      <div id="nav-container">
        <div class="nav-block" id="nav-intro">
          <div class="nav-en">HOW</div>
          <div class="nav-zh">玩法</div>
        </div>
        <div class="nav-block" id="nav-start">
          <div class="nav-en">START</div>
          <div class="nav-zh">开始</div>
        </div>
        <div class="nav-block" id="nav-about">
          <div class="nav-en">ABOUT</div>
          <div class="nav-zh">关于</div>
        </div>
      </div>
      <div id="intro-container" class="hover-container">
        <div class="close-button" id="close-intro">&times;</div>
        <div class="intro-scroll">
          <div class="intro-pics-container">
            <div class="intro-inner">
              <span><img src="img/intro-1.png"/></span>
              <span><img src="img/intro-2.png"/></span>
              <span><img src="img/intro-3.png"/></span>
            </div>
          </div>
        </div>
      </div>
      <div id="about-container" class="hover-container">
        <div class="close-button" id="close-about">&times;</div>
        <div id="about-inner">
          <div id="about-info">
            <p>Pits is a webpage game for relaxing. Help our little friends to walk through the pits and get delicious food. Enjoy it!</p>
            <p>这是一款轻松的网页游戏。帮助小伙伴们越过坑以得到美味的食物。玩得开心！</p>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script type="text/javascript">
  var listen = function (obj, e, trigger) {
    addEventListener && obj.addEventListener(e, trigger);
  };
  var addClass = function (obj, c) {
    if (!obj || !c) {
      return;
    }
    var currentClass = obj.className;
    if (!currentClass) {
      obj.className = c;
    } else {
      var currentArr = currentClass.split(' ').filter(function (s) {
        return !!s;
      });
      if (currentArr.indexOf(c) == -1) {
        currentArr.push(c);
        obj.className = currentArr.join(' ');
      }
    }
  };
  var removeClass = function (obj, c) {
    if (!obj || !obj.className || !c) {
      return;
    }
    var currentClass = obj.className;
    if (currentClass.indexOf(c) == -1) {
      return;
    } else {
      var currentArr = currentClass.split(' ').filter(function (s) {
        return !!s;
      });
      var index = currentArr.indexOf(c);
      if (index != -1) {
        currentArr.splice(index, 1);
        obj.className = currentArr.join(' ');
      }
    }
  };
  var renderCenterRect = function (obj, edge, screenWidth) {
    if (!obj) {
      return;
    }
    obj.style.width = edge + 'px';
    obj.style.height = edge + 'px';
    obj.style.left = (screenWidth - edge) / 2 + 'px';
  };
  var init = function () {
    var screenWidth = document.body.clientWidth;
    var screenHeight = document.body.clientHeight;
    var edgeLength = screenWidth < screenHeight ? screenWidth : screenHeight;
    var maxPitEdge = edgeLength / 5;
    var minPitEdge = maxPitEdge * 0.2;
    var currentPitEde = maxPitEdge;
    (minPitEdge > 20) && (minPitEdge = 20);
    var fillingMinEdge = minPitEdge / 2;
    var fillingMaxEdge = maxPitEdge * 2;
    var currentFillingEdge = fillingMinEdge;
    var mainContainer = document.querySelector('#main-container');
    var pitOne = document.querySelector('#pit-one');
    var pitTwo = document.querySelector('#pit-two');
    var fillingOne = document.querySelector('#filling-one');
    var fillingTwo = document.querySelector('#filling-two');
    var currentPit = pitOne;
    var currentFilling = fillingOne;
    var nextPit = pitTwo;
    var nextFilling = fillingTwo;
    var canEnlarge = false;
    document.body.className = screenWidth >= screenHeight ? 'horizontal' : 'vertical';
    var enlargeInterval;

    var openAbout = function () { addClass(document.querySelector('#about-container'), 'show'); };
    var closeAbout = function () { removeClass(document.querySelector('#about-container'), 'show'); };
    var openIntro = function () { addClass(document.querySelector('#intro-container'), 'show'); };
    var closeIntro = function () { removeClass(document.querySelector('#intro-container'), 'show'); };
    var initGame = function () {
      addClass(document.querySelector('#logo'), 'transparent');
      addClass(document.querySelector('#nav-container'), 'transparent');
      setTimeout(function () {
        addClass(document.querySelector('#logo'), 'hide');
        addClass(document.querySelector('#nav-container'), 'hide');
      }, 200);
      renderCenterRect(pitOne, currentPitEde, screenWidth);
      removeClass(fillingOne, 'hide');
      fillingOne.style.top = '20px';
      renderCenterRect(fillingOne, currentFillingEdge, screenWidth);
      setTimeout(function () {
        removeClass(fillingOne, 'smooth');
        canEnlarge = true;
      }, 200);
      listen(mainContainer, 'mousedown', startEnlargement);
      listen(mainContainer, 'mouseup', stopEnlargementAndStartFallDown);
    };
    var startEnlargement = function () {
      if (canEnlarge) {
        enlargeInterval && clearInterval(enlargeInterval);
        canEnlarge = false;
        enlargeInterval = setInterval(function () {
          currentFillingEdge < fillingMaxEdge && (currentFillingEdge += 1);
          renderCenterRect(currentFilling, currentFillingEdge, screenWidth);
        }, 10);
      }
    };
    var stopEnlargementAndStartFallDown = function () {
      enlargeInterval && clearInterval(enlargeInterval);
      enlargeInterval = null;
      addClass(currentFilling, 'smooth');
      var fillingTop = screenHeight * 0.5 - currentFillingEdge;
      if (currentFillingEdge <= currentPitEde) {
        fillingTop += currentPitEde;
      }
      currentFilling.style.top = fillingTop + 'px';
      setTimeout(function () {
        removeClass(currentFilling, 'smooth');
        // tryMoveForward();
      }, 300);
    };
    var startGame = function () {
      initGame();
    };
    listen(document.querySelector('#nav-about'), 'click', openAbout);
    listen(document.querySelector('#close-about'), 'click', closeAbout);
    listen(document.querySelector('#nav-intro'), 'click', openIntro);
    listen(document.querySelector('#close-intro'), 'click', closeIntro);
    listen(document.querySelector('#nav-start'), 'click', startGame);
  };
  </script>
</html>
